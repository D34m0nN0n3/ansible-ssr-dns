# Установка и настройка сервера разрешения имен ISC BIND 9 с помощью Ansible

??? abstract
    1. [Общее описание](#общее-описание)
    2. [Параметры](#параметры)
    3. [Теги](#теги)
    4. [Примеры](#примеры)
    5. [Дополнительные материалы](#дополнительные-материалы)

## Общее описание
Domain name server — приложение, предназначенное для ответов на DNS-запросы. По выполняемым функциям DNS-серверы делятся на несколько групп; сервер определённой конфигурации может относиться сразу к нескольким типам:

* Авторитативный DNS-сервер — сервер, отвечающий за какую-либо зону.
    * Мастер — имеет право на внесение изменений в данные зоны. Обычно зоне соответствует только один мастер-сервер. В случае Microsoft DNS-сервера и его интеграции с Active Directory мастер-серверов может быть несколько (так как репликация изменений осуществляется не средствами DNS-сервера, а средствами Active Directory, за счёт чего обеспечивается равноправность серверов и актуальность данных).
    * Слейв - не имеющий права на внесение изменений в данные зоны и получающий сообщения об изменениях от мастер-сервера. В отличие от мастер-сервера, их может быть (практически) неограниченное количество. Слейв также является авторитативным сервером (и пользователь не может различить мастер и слейв, разница появляется только на этапе конфигурирования/внесения изменений в настройки зоны).
* Кэширующий DNS-сервер — обслуживает запросы клиентов (получает рекурсивный запрос, выполняет его с помощью нерекурсивных запросов к авторитативным серверам или передаёт рекурсивный запрос вышестоящему DNS-серверу).
* Перенаправляющий DNS-сервер — перенаправляет полученные рекурсивные запросы вышестоящему кэширующему серверу в виде рекурсивных запросов. Используется преимущественно для снижения нагрузки на кэширующий DNS-сервер.
* Корневой DNS-сервер — сервер, являющийся авторитативным за корневую зону. Общеупотребительных корневых серверов в мире всего 13, их доменные имена находятся в зоне root-servers.net и называются a.root-servers.net, b.root-servers.net, …, m.root-servers.net. В определённых конфигурациях локальной сети возможна ситуация настройки локальных корневых серверов.
* Регистрирующий DNS-сервер. Сервер, принимающий динамические обновления от пользователей. Часто совмещается с DHCP-сервером. В Microsoft DNS-сервере при работе на контроллере домена сервер работает в режиме регистрирующего DNS-сервера, принимая от компьютеров домена информацию о соответствии имени и IP-адреса компьютера и обновляя в соответствии с ней данные зоны домена.

При выполнение роли устанавливается и настраивается [ISC BIND 9](https://www.isc.org/bind/). BIND (Berkeley Internet Name Domain, до этого: Berkeley Internet Name Daemon) — открытая и наиболее распространённая реализация DNS-сервера, обеспечивающая выполнение преобразования DNS-имени в IP-адрес и наоборот. Исполняемый файл-демон сервера BIND называется named. BIND поддерживается организацией Internet Systems Consortium. 10 из 13 корневых серверов DNS работают на BIND, оставшиеся 3 работают на NSD.

!!! note
    Роль настраивает два типа конфигураций: авторитативный DNS-сервер и кэширующий DNS-сервер, а так же их комбинацию.

!!! info RPZ
    Так же включена поддержка raesponse policy zone (зона политики ответа) - это механизм для введения настраиваемой политики на серверах системы доменных имен, чтобы рекурсивные распознаватели возвращали возможно измененные результаты. Зоны и их политика: "rpz.passeddomain.hosts" policy passthru; "rpz.changeddomain.hosts" policy given; "rpz.blockeddomain.hosts" policy nxdomain;

!!! attention
    Вместе с DNS сервером устанавливаются `node_exporter` и `bind_exporter`. Необходимо не забыть открыть в брандмауэр порты: `9100`, `9153`.

!!! tip
    Поддерживается загрузка предыдущей конфигурации из `git` репозитория.

## Параметры
|Название переменной               | Тип переменной | Значения по умолчанию | Описание                                                    |
|:---------------------------------|:--------------:|:---------------------:|:------------------------------------------------------------|
|prometheus_user                   | string         |                       | |
|node_exporter_url                 | string         |                       | |
|bind_exporter_url                 | string         |                       | |
|bind_forwarders                   | array          |                       | |
|bind_acl_int                      | array          |                       | |
|bind_acl_int_exclude              | array          |                       | |
|bind_acl_ext                      | array          |                       | |
|bind_acl_ext_exclude              | array          |                       | |
|bind_acl_change                   | boolean        |                       | |
|bind_cont_ph_num                  | string         |                       | |
|bind_cont_mail                    | string         |                       | |
|bind_srv_role                     | string         |                       | |
|bind_srv_type                     | string         |                       | |
|bind_ip_v6_on                     | boolean        |                       | |
|bind_max_cache                    | string         |                       | |
|bind_max_journal                  | string         |                       | |
|bind_cleanig_interval             | string         |                       | |
|alt_tranfer_src                   | boolean        |                       | |
|mf_format                         | string         |                       | |
|zero_ttl                          | boolean        |                       | |
|trust_clients                     | array          |                       | |
|trust_servers                     | array          |                       | |
|empty_zone_name                   | string         |                       | |
|bind_restore_last_conf            | boolean        |                       | |
|remote_git_repo                   | string         |                       | |
|local_git_repo                    | string         |                       | |

## Теги
|Тег            | Описание                     |
|:--------------|:-----------------------------|


## Примеры

!!! example "inventory/hosts"
    ``` ini

    ```

## Дополнительные материалы

