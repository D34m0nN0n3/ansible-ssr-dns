# Настройка DNS клиента в CentOS/RHEL 7 & 8 с помощью Ansible

??? Содержание
    1. [Общее описание](#общее-описание)
    2. [Параметры](#параметры)
    3. [Примеры](#примеры)
    4. [Дополнительные материалы](#дополнительные-материалы)

## Общее описание
DNS-клиент — программа (или модуль в программе), обеспечивающая определение IP-адреса узла по его полному имени. Для того чтобы программа-определитель могла выполнять свою задачу ей должен быть предоставлен доступ к серверам доменных имен. В фале `resolv.conf` содержатся адреса серверов имен, к которым имеет доступ данная система. После записей search идут записи `nameserver`, если таковые имеются. Для каждого сервера имен, к которому имеет доступ данная система, вводиься ключевое слово `nameserver` и IP-адрес.

!!! note "Примечание"
    В процессе выполнения роли отключается настройка управление DNS через `NetworkManager`, настройка производится только через `resolv.conf`.

## Параметры
|Название переменной  | Тип переменной | Значения по умолчанию | Описание                                                                                                          |
|:--------------------|:--------------:|:---------------------:|:------------------------------------------------------------------------------------------------------------------|
|dns_attempts         | string         | 3                     | Число запросов посылаемых клиентом до переключения на другой сервер при не ответе.                                |
|dns_timeout          | string         | 2                     | Время в секундах ожидания ответа от сервера до повторной попытки.                                                 |
|dns_ndots            | string         | 1                     | Число точек в аргументе, чтобы клиент произвел поиск по буквальному имени, прежде чем использовать список поиска. |
|dns_domain           | string         | 'ansible_domain'      | Задает локальное имя клиента.                                                                                     |
|dns_search           | array          | 'ansible_domain'      | Список доменов для поиска, при не полном указание имени.                                                          |
|nameserver           | array          | '1.1.1.1','8.8.8.8'   | Список DNS серверов.                                                                                              |

## Примеры

!!! example "inventory/hosts"
    ``` ini
    [example-servers]
    <host_name> ansible_ssh_host=<host_ip> ansible_ssh_user=<user_name_for_connect>

    [example-servers:vars]
    ansible_connection=ssh
    dns_search=['foo.example.com','bar.example.com']
    nameserver=['1.1.1.1','1.0.0.1','8.8.8.8','8.8.4.4']
    ```

![Example](../images/resolv.gif)

## Дополнительные материалы
- [Linux manual page - resolv.conf(5)](https://man7.org/linux/man-pages/man5/resolv.conf.5.html)
- [DNS configuration with Ansible](https://www.redhat.com/sysadmin/dns-configuration-ansible)
